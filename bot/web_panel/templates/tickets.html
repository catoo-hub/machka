{% extends "base.html" %} {% block title %}Machka Panel — Поддержка{% endblock
%} {% block content %}
<h1>Тикеты</h1>
<div class="filters">
  <a
    class="btn {% if not status %}active{% endif %}"
    href="{{ request.app.router['panel-tickets'].url_for() }}"
    >Все</a
  >
  <a
    class="btn {% if status == 'open' %}active{% endif %}"
    href="{{ request.app.router['panel-tickets'].url_for().with_query(status='open') }}"
    >Открытые</a
  >
  <a
    class="btn {% if status == 'closed' %}active{% endif %}"
    href="{{ request.app.router['panel-tickets'].url_for().with_query(status='closed') }}"
    >Закрытые</a
  >
</div>
<table class="table">
  <thead>
    <tr>
      <th>ID</th>
      <th>Пользователь</th>
      <th>Тема</th>
      <th>Статус</th>
      <th>Обновлён</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for ticket in tickets %}
    <tr>
      <td>{{ ticket.ticket_id }}</td>
      <td>{{ ticket.user_id or '—' }}</td>
      <td>{{ ticket.subject or '—' }}</td>
      <td>{{ ticket.status }}</td>
      <td>{{ ticket.updated_at or ticket.created_at }}</td>
      <td>
        <a
          class="btn btn-sm"
          href="{{ request.app.router['panel-ticket-detail'].url_for(ticket_id=str(ticket.ticket_id)) }}"
          >Открыть</a
        >
      </td>
    </tr>
    {% else %}
    <tr>
      <td colspan="6">Нет обращений.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<div class="pagination">
  {% if page > 1 %}
  <a href="{{ request.rel_url.with_query(status=status, page=page-1) }}"
    >Назад</a
  >
  {% endif %}
  <span>Стр. {{ page }} / {{ total_pages }}</span>
  {% if page < total_pages %}
  <a href="{{ request.rel_url.with_query(status=status, page=page+1) }}"
    >Вперед</a
  >
  {% endif %}
</div>
{% endblock %}
